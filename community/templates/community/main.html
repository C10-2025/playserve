{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'navbar.html' %}

<main class="w-full px-4">

    <section class="text-center py-16 md:py-24">
        <h1 class="text-4xl md:text-5xl font-extrabold uppercase tracking-wider text-white mb-8">
            Find Your Community
        </h1>
        <a href="{% url 'my_communities' %}" class="inline-block bg-yellow-400 text-blue-950 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-yellow-300 transition-all duration-300 transform hover:-translate-y-0.5">
            SEE MY COMMUNITIES
        </a>
    </section>

    <section class="bg-blue-900 bg-opacity-80 backdrop-blur-sm rounded-2xl p-6 md:p-12 lg:p-16 max-w-6xl mx-auto mb-24 shadow-2xl">
        
        <h2 class="text-center text-3xl font-bold text-white mb-10">
            Discover Communities
        </h2>

        <form method="GET" action="{% url 'discover_communities' %}" class="max-w-lg mx-auto mb-12">
            <div class="flex items-center gap-2 w-full bg-white rounded-full px-5 py-3 shadow-md">
                <input 
                    type="text" 
                    name="q" 
                    id="search-community" 
                    class="w-full border-none bg-transparent text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-0" 
                    placeholder="Search for a community..."
                    value="{{ search_query }}">
                
                <button type="submit" class="text-gray-400 hover:text-blue-600">
                    <img src="{% static 'image/search.svg' %}" alt="Search" class="w-5 h-5" />
                </button>
            </div>
        </form>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            {% for community in communities %}
            <div class="bg-white text-gray-900 rounded-xl p-6 text-left flex flex-col justify-between shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                
                <div>
                    <h3 class="text-xl font-extrabold mb-2">{{ community.name }}</h3>
                    <p class="text-base text-gray-600">{{ community.members.count }} members</p>
                </div>

                {% if community.id in joined_community_ids %}
                    <button class="w-full mt-4 py-2 px-4 rounded-lg bg-gray-400 text-white font-semibold cursor-not-allowed" disabled>
                        JOINED
                    </button>
                {% else %}
                    <form action="{% url 'join_community' community.id %}" method="POST" class="w-full">
                        {% csrf_token %}
                        <button type="submit" class="w-full mt-4 py-2 px-4 rounded-lg bg-green-500 text-white font-semibold hover:bg-green-600 transition-colors duration-200">
                            JOIN NOW
                        </button>
                    </form>
                {% endif %}
            </div>
            {% empty %}
            <p class="col-span-1 md:col-span-2 lg:col-span-3 text-center text-gray-300 p-8">
                No communities found.
            </p>
            {% endfor %}
            
        </div>
        </section>
    </main>

{% endblock %}